(async()=>{const t=async(t=.4)=>{await new Promise((e=>{setTimeout((()=>{e(!0)}),1e3*t)}))},e=await fetch("./data.json").then((t=>t.json())),a=(t="",e=null,a="div")=>{const n=document.createElement(a);if(n.innerHTML=t,e)for(const t in e)"innerHTML"!=t&&(n[t]=e[t]);return n},n=document.querySelector("form"),r=n.querySelector(".content"),l=document.getElementById("products"),o=document.getElementById("itemslist"),d=o.querySelector(".content"),c=o.querySelector(".info .total"),s={current:[],products:[],render:()=>{}},i=()=>{let t=0,e=0;return s.current.forEach((a=>{s.current.includes(a)&&(t=s.products[a].total+t,e=s.products[a].total*s.products[a].price)})),[t,e]};s.render=()=>{const[e,a]=i();o.setAttribute("data-total",e),c.innerHTML="$ "+a.toFixed(2),r.setAttribute("data-total","$ "+a.toFixed(2)),s.current.forEach((async e=>{const a=s.products[e],{cartInfo:n,finalInfo:l}=a;l.parentElement!=r&&(r.appendChild(l),await t(.05),l.removeAttribute("data-index")),n.parentElement!=d&&(d.appendChild(n),await t(.05),n.removeAttribute("data-index"))})),s.products.forEach((async(e,a)=>{if(s.current.includes(a))return;const{cartInfo:n,virtual:l,finalInfo:o}=e;n.setAttribute("data-index","null"),o.parentElement==r&&l.appendChild(o),n.parentElement==d&&await t(.3).then((()=>{n.parentElement==d&&0==e.total&&l.appendChild(n)}))}))};e.forEach(((t,e)=>{let n=e;const r=a("",null,"article");r.className="single_item";const o=`<img src="${t.image.mobile}" alt="${t.name}" srcset="${t.image.mobile} 480w,  ${t.image.tablet} 768w, ${t.image.desktop} 1024w">`,d=a(o,{className:"image_wrap"});r.appendChild(d);const c=a(`<p class="category">${t.category}</p><h2>${t.name}</h2><p class="price">$${t.price.toFixed(2)}</p>`,{className:"product_info"}),i={total:0,price:t.price,index:n,add:()=>{},remove:()=>{},virtual:a(),cartInfo:null,finalInfo:null,editable:null},p='<div class="inner add_element"><span class="cart"></span><span class="no_product">Add to cart</span></div>',u=a(p,{className:"add_remove"}),m=a(`<span class="substract action">-</span><input min="0" class="total" value="${i.total}" type="number"><span class="add_element action">+</span>`,{className:"inner filled"});i.virtual.appendChild(m);const f=m.querySelector(".total");f.addEventListener("input",(t=>{const{valueAsNumber:e}=t.target;e?(i.total=e,g(),s.render()):t.target.value=i.total}));const v=()=>{if(i.total<1&&m.parentNode!==i.virtual)return i.virtual.appendChild(m),void(u.innerHTML=p);i.total>0&&m.parentNode===i.virtual&&(u.innerHTML="",u.appendChild(m)),f.value=i.total};u.addEventListener("click",(t=>{const e=t.target?.closest(".substract"),a=t.target?.closest(".add_element");e?i.remove():a&&i.add()}));const h=(e=!1)=>{const n=a(i.total+"x",{className:"qty"}),r=a(`@ $${t.price.toFixed(2)}`,null,"span"),l=a("$"+t.price*i.total,{className:"total_price"},"span"),o=a(`<div class="name">${t.name}</div>`,{className:"infoitem"});if(o.appendChild(n),o.appendChild(r),o.appendChild(l),!e){const t=a('<span class="action"></span>',{className:"close"});t.addEventListener("click",(()=>{i.total=0,i.remove(!0)})),o.appendChild(t),o.setAttribute("data-index","null")}return o._updateCartInfo=()=>{const e=i.total<1?1:i.total;l.innerHTML=`$${(t.price*e).toFixed(2)}`,n.innerHTML=e+"x"},o},y=h(),E=a(`<input type="number" hidden name="product[${t.name}]" value="0"><img src="${t.image.thumbnail}">`,{className:"form_item_info"}),$=h(!0);E.appendChild($),i.cartInfo=y,i.finalInfo=E;const g=()=>{y._updateCartInfo(),$._updateCartInfo()};i.add=async()=>{i.total++,v(),s.current.includes(n)||s.current.push(n),g(),s.render()},i.remove=async(t=!1)=>{i.total=i.total-1,i.total<0&&(i.total=0),v(),0==i.total&&(s.current=s.current.filter((t=>t!=n))),t||g(),s.render()},r.appendChild(u),s.products[n]=i,r.appendChild(c),l.appendChild(r)}));const p=document.querySelector(".ordersubmit"),u=document.getElementById("modal");p.addEventListener("click",(()=>{i()<1||(u.className="active")})),n.addEventListener("submit",(t=>{t.preventDefault(),s.products.forEach((t=>{t.total=0,t.remove(!0)})),u.className=""}))})(),window.addEventListener("load",(function(){document.getElementById("root").classList.add("loaded")}));